<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å°ç£å¥½è¡Œé‡‘é–€ Aç·šï½œé›†ç« ä»»å‹™ï¼ˆè©¦ç©ç‰ˆï¼‰</title>
  <style>
    :root{font-family:system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto,Arial}
    body{margin:0;background:#0b0c10;color:#f5f5f5}
    .wrap{max-width:720px;margin:0 auto;padding:18px}
    .card{background:#141622;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;margin:12px 0;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    h1{font-size:22px;margin:6px 0 0}
    .sub{opacity:.85;font-size:13px;line-height:1.6;margin-top:8px}
    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.03);font-size:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{appearance:none;border:1px solid rgba(255,255,255,.12);background:#1d2140;color:#fff;border-radius:14px;padding:10px 12px;font-weight:800;cursor:pointer}
    .btn.secondary{background:#141622}
    .btn.good{background:#1f3d2c}
    input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#0f1120;color:#fff;font-size:16px}
    .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .bar{height:100%;background:#7aa2ff;width:0%}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .stamp{border:1px dashed rgba(255,255,255,.22);border-radius:14px;padding:10px;background:rgba(255,255,255,.03)}
    .stamp.done{border-style:solid;background:rgba(122,162,255,.12)}
    .tiny{font-size:12px;opacity:.85;line-height:1.6}
    @media (max-width:520px){.grid2{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="pill">ğŸšŒ å°ç£å¥½è¡Œé‡‘é–€ï½œAç·šè©¦ç©</div>
      <h1>å¥½è¡Œé‡‘é–€ï¼šAç·šé›†ç« ä»»å‹™</h1>
      <div class="sub">
        ç©æ³•ï¼š<b>åˆ°ç«™æƒ QRï¼ˆé€™è£¡å…ˆç”¨è¼¸å…¥ç¢¼ä»£æ›¿ï¼‰â†’ ç­”é¡Œ â†’ é›†ç« </b><br/>
        ä½ å®Œæˆ 3 æšç« ï¼Œå°±æœƒçœ‹åˆ°ã€Œå®Œæˆå¾½ç« ã€ç•«é¢ï¼ˆç”¨ä¾†åšè¡ŒéŠ·å°æµ/åˆ°åº—å…Œæ›ï¼‰ã€‚
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="pill">ğŸ“ ç›®å‰è·¯ç·šï¼šAç·š</div>
          <div class="sub">æ°´é ­â€”ç¿Ÿå±±ï¼ˆç¤ºæ„ç‰ˆï¼‰ï¼šæŠŠã€Œæ­å…¬è»Šã€è®Šæˆé—–é—œæ—…è¡Œã€‚</div>
        </div>
        <button class="btn secondary" id="resetBtn">é‡ç½®é€²åº¦</button>
      </div>

      <div style="margin-top:12px">
        <div class="row" style="justify-content:space-between">
          <div class="tiny">é›†ç« é€²åº¦</div>
          <div class="tiny" id="progressText">0/3</div>
        </div>
        <div class="progress"><div class="bar" id="bar"></div></div>
      </div>

      <div class="grid2" style="margin-top:12px">
        <div class="card" style="margin:0">
          <h3 style="margin:0 0 8px;font-size:14px">â‘  è¼¸å…¥ç«™é»ç¢¼ï¼ˆæ¨¡æ“¬æƒ QRï¼‰</h3>
          <input id="codeInput" placeholder="ä¾‹å¦‚ A-01ã€A-02ã€A-03" />
          <div class="row" style="margin-top:10px">
            <button class="btn" id="redeemBtn">é–‹å§‹ä»»å‹™</button>
            <button class="btn secondary" id="demoBtn">æˆ‘æƒ³è©¦ç©ï¼ˆè‡ªå‹•çµ¦ç¢¼ï¼‰</button>
          </div>
          <div class="tiny" style="margin-top:10px">
            ä¹‹å¾Œä½ åªè¦åš QR code æŒ‡å‘ï¼š<span style="opacity:.9">.../index.html?code=A-01</span>ï¼Œæƒæå°±æœƒè‡ªå‹•å¸¶å…¥ã€‚
          </div>
        </div>

        <div class="card" style="margin:0">
          <h3 style="margin:0 0 8px;font-size:14px">â‘¡ ä»»å‹™ï¼ˆç­”å°æ‰çµ¦ç« ï¼‰</h3>
          <div id="missionBox" class="tiny" style="opacity:.8">è«‹å…ˆè¼¸å…¥ç«™é»ç¢¼ã€‚</div>
          <div id="missionActions" class="row" style="margin-top:10px;display:none"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3 style="margin:0 0 10px;font-size:14px">ä½ çš„ Aç·šæ•¸ä½ç« </h3>
        <div class="grid2" id="stamps"></div>
        <div class="tiny" style="margin-top:10px">
          âœ… ç¾åœ¨å…ˆåš 3 ç«™ç¤ºç¯„ï¼šA-01 / A-02 / A-03ï¼ˆä½ ä¹‹å¾Œçµ¦æˆ‘ A ç·šçœŸå¯¦ç«™é»ï¼Œæˆ‘å†å¹«ä½ æ›æˆæ­£å¼ç‰ˆï¼‰
        </div>
      </div>
    </div>

    <div class="card" id="finish" style="display:none">
      <div class="pill">ğŸ‰ å®Œæˆ Aç·šå¾½ç« </div>
      <h2 style="margin:8px 0 6px;font-size:18px">ä½ è§£é–äº†ã€ŒAç·šå¥½è¡Œå¾½ç« ã€ï¼</h2>
      <div class="sub" id="rewardText"></div>
      <div class="row" style="margin-top:12px">
        <button class="btn good" id="shareBtn">ä¸€éµåˆ†äº«</button>
      </div>
      <div class="tiny" style="margin-top:10px" id="couponHint"></div>
    </div>
  </div>

<script>
const key="km_a_line_game_v1";
const state=JSON.parse(localStorage.getItem(key)||"{}");

const STAMPS=["A-01","A-02","A-03"];
const QUESTIONS=[
  {q:"å°ç£å¥½è¡ŒAç·šè¡ŒéŠ·éŠæˆ²æœ€å¸Œæœ›æ—…å®¢åšä»€éº¼ï¼Ÿ", a:["åªçœ‹ä¸å‹•","æ­è»Šåˆ°ç«™äº’å‹•é›†ç« ","ç›´æ¥å›é£¯åº—"], correct:1},
  {q:"æƒæç«™é»QRæœ€é©åˆç”¨ä¾†ï¼Ÿ", a:["å¢åŠ æ’éšŠ","å¼•å°åˆ°æ™¯é»/åº—å®¶ä¸¦å®Œæˆä»»å‹™","è®“æ—…å®¢è¿·è·¯"], correct:1},
  {q:"å®Œæˆé›†ç« å¾Œæœ€é©åˆåšä»€éº¼ï¼Ÿ", a:["åˆ†äº«æ‰“å¡å°æµ","ç«‹åˆ»åˆªé™¤","ä»€éº¼éƒ½ä¸åš"], correct:0},
];

function save(){localStorage.setItem(key,JSON.stringify(state));}
function $(s){return document.querySelector(s);}

function render(){
  state.stamps ||= [];
  const got=state.stamps.length;
  $("#progressText").textContent=`${got}/${STAMPS.length}`;
  $("#bar").style.width=`${Math.min(100,(got/STAMPS.length)*100)}%`;

  const stampsEl=$("#stamps");
  stampsEl.innerHTML="";
  STAMPS.forEach(code=>{
    const done=state.stamps.includes(code);
    const d=document.createElement("div");
    d.className="stamp"+(done?" done":"");
    d.innerHTML=`<div style="font-weight:900">${done?"âœ… å·²é›†ç« ":"â¬œ æœªé›†ç« "}</div>
                 <div class="tiny" style="opacity:.8">ç«™é»ç¢¼ï¼š${code}</div>`;
    stampsEl.appendChild(d);
  });

  if(got>=STAMPS.length){
    $("#finish").style.display="";
    const device=(state.deviceId ||= Math.random().toString(16).slice(2,10)).toUpperCase();
    const coupon=`KM-A-${device}`;
    $("#rewardText").textContent="å¯å¼•å°ç©å®¶åˆ°åˆä½œåº—å®¶å‡ºç¤ºæ­¤ç•«é¢æ›å°ç¦®/æŠ˜æ‰£ï¼ˆæ­£å¼ç‰ˆå¯åšæ ¸éŠ·ï¼‰ã€‚";
    $("#couponHint").textContent=`ç¤ºç¯„å…Œæ›ç¢¼ï¼š${coupon}`;
    save();
  }else{
    $("#finish").style.display="none";
  }
}

function showMission(code){
  const t=(code||"").trim().toUpperCase();
  const box=$("#missionBox");
  const act=$("#missionActions");
  act.style.display="none";

  if(!/^A-\d{2}$/.test(t)){
    box.style.opacity=.85;
    box.textContent="ç¢¼æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹è¼¸å…¥ A-01ã€A-02ã€A-03ã€‚";
    return;
  }
  if(!STAMPS.includes(t)){
    box.style.opacity=.85;
    box.textContent="ç›®å‰è©¦ç©ç‰ˆåªé–‹æ”¾ A-01~A-03ã€‚";
    return;
  }
  if(state.stamps.includes(t)){
    box.style.opacity=.85;
    box.textContent=`${t} å·²ç¶“æ‹¿éç« äº†ï¼æ›ä¸‹ä¸€ç«™ï½`;
    return;
  }

  const q=QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
  box.style.opacity=1;
  box.innerHTML=`<div style="font-weight:900;margin-bottom:8px">ä»»å‹™ï¼šç­”å°æ‰çµ¦ç« ï¼ˆ${t}ï¼‰</div>
                 <div style="margin-bottom:10px">${q.q}</div>`;
  act.innerHTML="";
  q.a.forEach((opt,idx)=>{
    const b=document.createElement("button");
    b.className="btn secondary";
    b.textContent=`${idx+1}. ${opt}`;
    b.onclick=()=>{
      if(idx===q.correct){
        state.stamps.push(t); save();
        box.innerHTML=`âœ… æ­å–œç­”å°ï¼ä½ ç²å¾—æ•¸ä½ç« ï¼š<b>${t}</b>`;
        act.style.display="none";
        render();
      }else{
        box.innerHTML="å†è©¦ä¸€æ¬¡ï½æç¤ºï¼šç­”æ¡ˆè·Ÿã€Œäº’å‹•é›†ç« /å°æµã€æœ‰é—œã€‚";
      }
    };
    act.appendChild(b);
  });
  act.style.display="flex";
}

$("#redeemBtn").onclick=()=>showMission($("#codeInput").value);
$("#demoBtn").onclick=()=>{
  state.stamps ||= [];
  const next=STAMPS.find(x=>!state.stamps.includes(x)) || STAMPS[0];
  $("#codeInput").value=next;
  showMission(next);
};
$("#resetBtn").onclick=()=>{localStorage.removeItem(key); location.href=location.pathname;};

$("#shareBtn").onclick=async ()=>{
  const text="æˆ‘å‰›å®Œæˆå°ç£å¥½è¡Œé‡‘é–€ Aç·š é›†ç« ä»»å‹™ï¼ğŸšŒâœ¨ #å°ç£å¥½è¡Œ #é‡‘é–€";
  try{
    if(navigator.share){ await navigator.share({title:"å°ç£å¥½è¡Œé‡‘é–€ Aç·š", text}); }
    else{ await navigator.clipboard.writeText(text); alert("å·²è¤‡è£½åˆ†äº«æ–‡æ¡ˆåˆ°å‰ªè²¼ç°¿ï¼"); }
  }catch(e){ alert("åˆ†äº«å–æ¶ˆæˆ–ä¸å¯ç”¨ã€‚"); }
};

// æ”¯æ´ ?code=A-01
(function boot(){
  const url=new URL(location.href);
  const code=url.searchParams.get("code");
  if(code){ $("#codeInput").value=code.toUpperCase().trim(); showMission(code); }
  render();
})();
</script>
</body>
</html>
